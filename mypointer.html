<!doctype html>
<html>
  <head>
    <style>
      #square {
        color: white;
        -webkit-user-select: none; /* Safari */
        -moz-user-select: none; /* Firefox */
        -ms-user-select: none; /* IE10+/Edge */
        user-select: none; /* Standard */
        position: relative;
        top: 300px;
        left: 50%;
        background: rgb(0, 170, 0);
        height: 100px;
        width: 100px;
      }
    </style>
  </head>
  <body style='height: 1000px'>
    <button id='element'>
      Hello.
    </button>
    <div id='square'>
      Click me!
    </div>
    <img width="14px" height="14px" id='cursor' style='position: fixed; display: none;'  src='graphics\Circle.png' />
    <script type="text/javascript">
      var square = document.getElementById('square');
      var element = document.getElementById('element');
      var cursor = document.getElementById('cursor');
      var factor = 10;
      var havePointerLock = 'pointerLockElement' in document ||
          'mozPointerLockElement' in document ||
          'webkitPointerLockElement' in document;

      cursor.requestPointerLock = cursor.requestPointerLock ||
  			     cursor.mozRequestPointerLock ||
  			     cursor.webkitRequestPointerLock;

      cursor.style.top = '50px';
      cursor.style.left = '50px';
      // Ask the browser to lock the pointer
      element.onclick = cursor.requestPointerLock;

      function squareswitch(){
          if(square.style.backgroundColor == 'rgb(0, 0, 170)'){
            square.style.backgroundColor = 'rgb(170, 0, 0)';
          } else {
            square.style.backgroundColor = 'rgb(0, 0, 170)';
          }
      }

      function pix2num(pix){
        return parseFloat(pix.substring(0, pix.length - 2));
      }

      function lockclick(bb){
        var x = pix2num(cursor.style.left) + cursor.width/2;
        var y = pix2num(cursor.style.top) + cursor.height/2;

        if (x >= bb.left && x <= bb.right && y >= bb.top && y <= bb.bottom) {
          square.onclick.call(square);
        }

      }

      square.onclick = squareswitch;


      // Hook pointer lock state change events
      document.addEventListener('pointerlockchange', changeCallback, false);
      document.addEventListener('mozpointerlockchange', changeCallback, false);
      document.addEventListener('webkitpointerlockchange', changeCallback, false);

      function changeCallback(e){

        if (document.pointerLockElement === element ||
              document.mozPointerLockElement === element ||
              document.webkitPointerLockElement === element) {
            // Pointer was just locked
            // Enable the mousemove listener
            document.addEventListener("mousemove", moveCallback, false);
            cursor.style.display = 'inline';

            if(document.onclick == undefined){
              var lockedclick = lockclick.bind(this, square.getBoundingClientRect());
              document.onclick = lockedclick;
            }
          } else {
            // Pointer was just unlocked
            // Disable the mousemove listener
            document.removeEventListener("mousemove", moveCallback, false);
            cursor.style.display = 'hidden';

            document.onclick = undefined;
        }
      }

      function moveCallback(e){
        var movementX = e.movementX ||
            e.mozMovementX          ||
            e.webkitMovementX       ||
            0,
        movementY = e.movementY ||
            e.mozMovementY      ||
            e.webkitMovementY   ||
            0;

        if(movementX > 0){
          var newleft = pix2num(cursor.style.left) + movementX/factor;
          if(newleft < 1920){
            cursor.style.left = newleft.toString() + "px";
          }
        } else if(movementX < 0){
          var newleft = pix2num(cursor.style.left) + movementX/factor;
          if(newleft > 0){
            cursor.style.left = newleft.toString() + "px";
          }
        }

        if(movementY > 0){
          var newtop = pix2num(cursor.style.top) + movementY/factor;
          if(newtop < 1000){
            cursor.style.top = newtop.toString() + "px";
          }
        } else if(movementY < 0){
          var newtop = pix2num(cursor.style.top) + movementY/factor;
          if(newtop > 0){
            cursor.style.top = newtop.toString() + "px";
          }
        }
      }

  // Ask the browser to release the pointer
      document.exitPointerLock = document.exitPointerLock ||
  			   document.mozExitPointerLock ||
  			   document.webkitExitPointerLock;
      document.exitPointerLock();
    </script>
  </body>
</html>
